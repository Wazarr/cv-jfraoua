---
import { ViewTransitions } from "astro:transitions";
import MobileNav from "../components/MobileNav.astro";

interface Props {
  title: string;
}

const { title } = Astro.props;

function getCurrentYear() {
  return new Date().getFullYear();
}
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="description"
      content="Jérémy Fraoua - Quantitative Risk Analyst & AI Developer. Explore my portfolio featuring VibeTrip, HaxballGym, and data science projects."
    />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <ViewTransitions />
    <title>{title}</title>
    <!-- Google Fonts for better typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <script is:inline>
      // Theme management with proper persistence
      function initTheme() {
        // Check for saved theme or default to dark
        const savedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        const theme = savedTheme || (prefersDark ? "dark" : "light");

        // Apply theme
        document.documentElement.classList.toggle("dark", theme === "dark");
        localStorage.setItem("theme", theme);
        return theme;
      }

      // Initialize theme immediately to prevent flash
      initTheme();
    </script>
  </head>

  <body
    class="bg-light-50 dark:bg-dark-950 text-light-900 dark:text-dark-100 font-sans transition-colors duration-200"
  >
    <div class="wrapper flex flex-col min-h-screen">
      <!-- Header with Claude Code aesthetic -->
      <header
        class="bg-light-100/90 dark:bg-dark-900/90 border-b border-light-300 dark:border-dark-700 backdrop-blur-sm sticky top-0 z-50"
      >
        <div class="container mx-auto px-4 lg:px-6">
          <!-- Top bar with branding and chatbot -->
          <div class="flex items-center justify-between py-4">
            <div class="flex items-center space-x-6">
              <a
                href="/"
                class="text-xl font-semibold text-primary-400 hover:text-primary-300 transition-colors"
              >
                <span class="font-mono">jeremy@portfolio:~$</span>
              </a>
              <div
                class="hidden lg:flex items-center space-x-4 text-sm text-light-600 dark:text-dark-300"
              >
                <span class="font-mono">Quantitative Risk Analyst</span>
                <span class="text-light-500 dark:text-dark-600">•</span>
                <span class="font-mono">AI Developer</span>
              </div>
            </div>

            <!-- Theme Toggle and Social Links -->
            <div class="flex items-center space-x-4">
              <!-- Theme Toggle -->
              <button
                id="theme-toggle"
                class="p-2 rounded-lg bg-light-300 dark:bg-dark-800 hover:bg-light-400 dark:hover:bg-dark-700 transition-colors border border-light-400 dark:border-dark-600"
                title="Toggle theme"
              >
                <!-- Sun icon (show in dark mode) -->
                <svg
                  id="sun-icon"
                  class="w-5 h-5 text-light-700 dark:text-dark-300 hidden dark:block"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                  />
                </svg>
                <!-- Moon icon (show in light mode) -->
                <svg
                  id="moon-icon"
                  class="w-5 h-5 text-light-700 dark:text-dark-300 block dark:hidden"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                  />
                </svg>
              </button>

              <!-- Social Links -->
              <div class="hidden md:flex items-center space-x-3">
                <a
                  href="https://www.linkedin.com/in/j%C3%A9r%C3%A9my-fraoua/"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-dark-400 hover:text-code-400 transition-colors p-2"
                  title="LinkedIn"
                >
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"
                    ></path>
                  </svg>
                </a>
                <a
                  href="https://github.com/Wazarr94"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-dark-400 hover:text-terminal-400 transition-colors p-2"
                  title="GitHub"
                >
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                    ></path>
                  </svg>
                </a>
                <a
                  href="mailto:jeremy.fraoua@gmail.com"
                  class="text-dark-400 hover:text-primary-400 transition-colors p-2"
                  title="Email"
                >
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                    ></path>
                  </svg>
                </a>
              </div>
            </div>
          </div>

          <!-- Desktop Navigation -->
          <nav class="hidden md:block border-t border-light-300 dark:border-dark-700 py-3">
            <div class="flex items-center justify-center space-x-8">
              <a
                href="/"
                class="nav-link text-sm font-mono font-medium text-light-600 dark:text-dark-300 hover:text-terminal-400 transition-colors border-b-2 border-transparent hover:border-terminal-400"
              >
                <span class="text-terminal-400">/</span>home
              </a>
              <a
                href="/resume"
                class="nav-link text-sm font-mono font-medium text-light-600 dark:text-dark-300 hover:text-code-400 transition-colors border-b-2 border-transparent hover:border-code-400"
              >
                <span class="text-code-400">/</span>resume
              </a>
              <a
                href="/projects"
                class="nav-link text-sm font-mono font-medium text-light-600 dark:text-dark-300 hover:text-primary-400 transition-colors border-b-2 border-transparent hover:border-primary-400"
              >
                <span class="text-primary-400">/</span>projects
              </a>
              <a
                href="/blog"
                class="nav-link text-sm font-mono font-medium text-light-600 dark:text-dark-300 hover:text-light-800 dark:hover:text-dark-100 transition-colors border-b-2 border-transparent hover:border-light-800 dark:hover:border-dark-100"
              >
                <span class="text-dark-100">/</span>blog
              </a>
              <a
                href="/chat"
                class="nav-link text-sm font-mono font-medium text-light-600 dark:text-dark-300 hover:text-primary-400 transition-colors border-b-2 border-transparent hover:border-primary-400"
              >
                <span class="text-primary-400">/</span>chat
              </a>
            </div>
          </nav>

          <!-- Mobile Navigation -->
          <div class="md:hidden border-t border-light-300 dark:border-dark-700 py-3">
            <MobileNav />
          </div>
        </div>
      </header>
      <main class="flex-grow">
        <slot />
      </main>

      <!-- Footer with terminal aesthetic -->
      <footer class="bg-light-100 dark:bg-dark-900 border-t border-light-300 dark:border-dark-700 mt-auto">
        <div class="container mx-auto py-4 px-4">
          <div class="text-center md:flex md:items-center md:justify-between">
            <!-- Mobile: Simple footer -->
            <div class="md:hidden space-y-2">
              <div class="text-light-600 dark:text-dark-400 text-sm">
                Built with <a href="https://astro.build" class="text-primary-400 hover:text-primary-300">Astro</a>
              </div>
              <div class="text-light-600 dark:text-dark-400 text-xs">
                © {getCurrentYear()} Jérémy Fraoua
              </div>
            </div>
            
            <!-- Desktop: Full footer -->
            <div class="hidden md:flex md:items-center md:justify-between md:w-full">
              <div class="text-light-600 dark:text-dark-400 font-mono text-sm">
                <span class="text-terminal-400">jeremy@portfolio:~$</span>
                <span class="text-light-700 dark:text-dark-300"> Built with </span>
                <a
                  href="https://astro.build"
                  class="text-primary-400 hover:text-primary-300 transition-colors"
                  >Astro</a
                >
                <span class="text-light-700 dark:text-dark-300"> and </span>
                <a
                  href="https://tailwindcss.com"
                  class="text-code-400 hover:text-code-300 transition-colors"
                  >Tailwind</a
                >
              </div>
              <div class="text-light-600 dark:text-dark-400 font-mono text-sm">
                © {getCurrentYear()} Jérémy Fraoua
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <style is:global>
      html {
        font-family: "Inter", system-ui, sans-serif;
        scroll-behavior: smooth;
        height: 100%;
      }

      body {
        height: 100%;
        overflow-y: auto;
        overscroll-behavior-y: contain;
        font-feature-settings:
          "liga" 1,
          "kern" 1;
        text-rendering: optimizeLegibility;
      }

      .wrapper {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      /* Custom scrollbar for terminal aesthetic */
      body::-webkit-scrollbar {
        width: 8px;
      }

      /* Dark mode scrollbar */
      .dark body::-webkit-scrollbar-track {
        background: #020617;
      }

      .dark body::-webkit-scrollbar-thumb {
        background-color: #334155;
        border-radius: 4px;
      }

      .dark body::-webkit-scrollbar-thumb:hover {
        background-color: #475569;
      }

      /* Light mode scrollbar */
      body::-webkit-scrollbar-track {
        background: #f8f9fa;
      }

      body::-webkit-scrollbar-thumb {
        background-color: #dadce0;
        border-radius: 4px;
      }

      body::-webkit-scrollbar-thumb:hover {
        background-color: #9aa0a6;
      }

      /* Terminal cursor animation */
      @keyframes terminal-blink {
        0%,
        50% {
          opacity: 1;
        }
        51%,
        100% {
          opacity: 0;
        }
      }

      .terminal-cursor::after {
        content: "▌";
        animation: terminal-blink 1s infinite step-end;
        color: #22c55e;
      }

      /* Navigation active state */
      .nav-link.active {
        color: #f97316 !important;
        border-bottom-color: #f97316 !important;
      }

      /* Light mode navigation active state - use darker orange for better contrast */
      html:not(.dark) .nav-link.active {
        color: #d35400 !important;
        border-bottom-color: #d35400 !important;
      }

      /* Smooth transitions for better UX */
      * {
        transition:
          color 0.2s ease,
          border-color 0.2s ease,
          background-color 0.2s ease;
      }

      /* Code blocks styling */
      pre,
      code {
        font-family: "JetBrains Mono", "Fira Code", monospace;
        font-feature-settings:
          "liga" 1,
          "calt" 1;
      }
    </style>
    <script>
      // Theme toggle functionality with proper persistence
      function setupThemeToggle() {
        const themeToggle = document.getElementById("theme-toggle");

        if (themeToggle) {
          // Remove existing listeners to prevent duplicates
          themeToggle.replaceWith(themeToggle.cloneNode(true));
          const newThemeToggle = document.getElementById("theme-toggle");

          if (newThemeToggle) {
            newThemeToggle.addEventListener("click", () => {
            const isDark = document.documentElement.classList.contains("dark");
            const newTheme = isDark ? "light" : "dark";

            document.documentElement.classList.toggle(
              "dark",
              newTheme === "dark"
            );
            localStorage.setItem("theme", newTheme);
            });
          }
        }
      }

      function setupNavigation() {
        // Active nav state management
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll(".nav-link");

        navLinks.forEach((link) => {
          link.classList.remove("active");
          const href = link.getAttribute("href");
          if (href === currentPath || (currentPath === "/" && href === "/")) {
            link.classList.add("active");
          }
        });
      }

      // Initial setup
      document.addEventListener("DOMContentLoaded", () => {
        setupThemeToggle();
        setupNavigation();
      });

      // Handle Astro page transitions
      document.addEventListener("astro:after-swap", () => {
        // Re-apply theme from localStorage
        const savedTheme = localStorage.getItem("theme") || "dark";
        document.documentElement.classList.toggle(
          "dark",
          savedTheme === "dark"
        );

        // Re-setup functionality
        setupThemeToggle();
        setupNavigation();
      });

      // Handle browser navigation (back/forward)
      document.addEventListener("astro:page-load", () => {
        setupNavigation();
      });
    </script>
  </body>
</html>
