---
import { getEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Badge from "../../components/Badge.astro";
import { tagCategories } from "../../content/config";

const { slug } = Astro.params;

if (!slug) {
  throw new Error("Slug is required");
}

const entry = await getEntry("blog", slug);

if (!entry) {
  return Astro.redirect("/404");
}

const { Content } = await entry.render();
---

<Layout title={entry.data.title}>
  <article
    class="max-w-4xl mx-auto bg-white dark:bg-gray-800 shadow-lg rounded-lg overflow-hidden"
  >
    <div class="p-8">
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-4 text-gray-900 dark:text-white">
          {entry.data.title}
        </h1>
        <p class="text-gray-600 dark:text-gray-400 mb-4">
          {entry.data.pubDate.toLocaleDateString()}
        </p>
        <div class="flex justify-center gap-2 mb-6">
          {
            entry.data.tags
              ?.filter((tag) => tagCategories.includes(tag as any))
              .map((tag) => <Badge>{tag}</Badge>)
          }
        </div>
      </div>
      <div class="prose dark:prose-invert max-w-none">
        <Content />
      </div>
    </div>
  </article>
</Layout>

<script>
  // This script attempts to maintain the theme when navigating between pages
  document.addEventListener("astro:after-swap", () => {
    const theme = localStorage.getItem("theme");
    if (theme === "dark") {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
  });
</script>
